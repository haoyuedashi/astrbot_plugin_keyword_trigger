# 🔑 关键词触发插件

> 群内免指令前缀触发其他插件功能的 AstrBot 插件。

## ✨ 功能介绍

让用户无需输入 `/` 或 `#` 前缀即可触发 AstrBot 的命令，大幅降低使用门槛。

### 工作原理

```
用户发送消息 → 关键词匹配 → 自动添加 / 前缀 → 创建命令事件 → 派发到事件队列 → 触发目标插件
```

### 核心特性

- 🎯 **前缀匹配**：支持关键词后携带参数（如 `购买宝宝 @群友`）
- 🔄 **智能去重**：自动跳过已带 `/` 或 `#` 前缀的消息，避免重复处理
- 🛡️ **防止递归**：通过 `message_id` 前缀标记机制，防止自身触发的事件被再次处理
- 📎 **组件保留**：自动提取并保留原始消息中的 `@` 提及等非文本组件
- 🌐 **多平台适配**：支持 aiocqhttp、QQ 官方、Telegram、Discord、Slack、飞书、微信、WebChat、钉钉等主流平台
- ⚡ **事件阻断**：匹配成功后自动阻止原消息继续传播，避免 LLM 误响应

## 📖 使用示例

| 用户输入 | 插件行为 | 触发命令 |
|---------|---------|---------|
| `打工` | ✅ 完全匹配 | `/打工` |
| `宝宝菜单` | ✅ 完全匹配 | `/宝宝菜单` |
| `购买宝宝 @群友` | ✅ 前缀匹配（保留 @ 组件） | `/购买宝宝 @群友` |
| `/打工` | ❌ 跳过 | 直接由 AstrBot 处理 |
| `#打工` | ❌ 跳过 | 直接由 AstrBot 处理 |
| `去打工` | ❌ 不匹配 | 无 |

## ⚙️ 配置说明

在 AstrBot 后台配置插件参数：

### keywords（关键词列表）

配置需要触发的关键词，支持多个。当存在多个关键词可匹配时，插件会**优先匹配最长的关键词**，避免短词误触发。

**示例配置：**
```json
["打工", "宝宝菜单", "踩雷", "签到", "购买宝宝"]
```

### enable_group_only（仅群聊触发）

- `true`（默认）：只在群聊中触发
- `false`：私聊也可触发

## 🏗️ 项目结构

```
astrbot_plugin_keyword_trigger/
├── main.py              # 插件主入口，消息监听与关键词匹配
├── core/
│   └── event_factory.py # 事件工厂，根据平台类型创建正确的事件对象
├── _conf_schema.json    # 插件配置定义
├── metadata.yaml        # 插件元数据
└── README.md            # 说明文档
```

## ⚠️ 注意事项

1. **前缀匹配**：用户消息以关键词开头即可触发，支持后接参数
2. **最长匹配优先**：配置 `购买` 和 `购买宝宝` 时，输入 `购买宝宝` 会匹配更长的关键词
3. **不重复触发**：已经带 `/` 或 `#` 前缀的消息不会被处理
4. **事件阻断**：匹配成功后原消息会被阻断，不会传递给 LLM 或其他插件

## 📦 安装

将插件文件夹放入 AstrBot 的 `data/plugins/` 目录，重启 AstrBot 即可。

## 👤 作者

haoyuedashi
